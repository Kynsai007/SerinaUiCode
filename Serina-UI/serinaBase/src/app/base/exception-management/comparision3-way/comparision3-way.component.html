<div *ngIf="!editable && !grnCreateBoolean" class="pos_rel">
  <span class="goBackIn ml-3" (click)="backToInvoice()">
    <mat-icon class="goBack_pos" svgIcon="back_arrow"></mat-icon>
  </span>
  <h6 class="headh6 pl-80">View {{ Itype }}</h6>
</div>
<div *ngIf="editable || grnCreateBoolean" class="pos_rel">
  <span class="goBackIn ml-3" (click)="backToInvoice()">
    <mat-icon class="goBack_pos" svgIcon="back_arrow"></mat-icon>
  </span>
  <h6 class="headh6 pl-80">{{ headerName }}</h6>
</div>
<div class="row invoice-body">
  <div
    class="viewPdf"
    style="right: 340px"
    *ngIf="
      (editPermissionBoolean ||
        changeApproveBoolean ||
        financeApproveBoolean) &&
      submitBtn_boolean &&
      this.currentTab == 'line' &&
      ap_boolean &&
      !showPdf &&
      isDesktop&& !GRN_PO_Bool
    "
  >
    <!-- <button
      class="btnUpload btn_extra_bg mr-2"
      (click)="open_dialog_comp('Amend')"
    >
      PO Amend request
    </button> -->

    <button
      *ngIf="ap_boolean"
      class="btnUpload m-t-neg btn_extra_bg ml-2 mr-2"
      [ngClass]="subStatusId == 75 || subStatusId == 17 ? 'bt-hlt' : ''"
      (click)="opengrnDailog()"
    >
      Select GRN
    </button>
    <button
      *ngIf="
        portalName == 'customer' &&
        flipEnabled &&
        (subStatusId == 8 ||
          subStatusId == 16 ||
          subStatusId == 21 ||
          subStatusId == 27)
      "
      class="btnUpload btn_extra_bg m-t-neg ml-2"
      (click)="open_dialog_comp('flip line','')"
    >
      Flip PO
    </button>
  </div>
  <!-- <div class="viewPdf" style="right: 100px" *ngIf="!isPdfAvailable && ap_boolean">
    <button class="btnUpload" (click)="DownloadPDF()">
      <i class="fa fa-download" aria-hidden="true"></i>
    </button>
  </div> -->
  <div class="viewPdf" *ngIf="!isPdfAvailable && !showPdf && ap_boolean && isDesktop">
    <button class="btnUpload" (click)="viewPdf()">{{ btnText }}</button>
  </div>

  <div *ngIf="!showPdf && !ap_boolean && isDesktop" class="btns_line">
    <div class="mr-3" *ngIf="!isPdfAvailable">
      <span class="f-12 pointer" (click)="viewPdf()">{{ btnText }}</span>
    </div>
    <div>
      <button *ngIf="editable" class="f-12 btn_stck mr-3" (click)="viewPdf()">
        View Stock Availability
      </button>
    </div>
    <div>
      <button *ngIf="editable" class="f-12 btn_hold" (click)="viewPdf()">Put PO On Hold</button>
    </div>
  </div>

  <div
    *ngIf="submitBtn_boolean && ap_boolean && !GRN_PO_Bool && !showPdf && isDesktop && currentTab == 'line' " 
    class="changePOInput"
  >
    <p-autoComplete
      [(ngModel)]="selectedPONumber"
      (onSelect)="onSelectPO($event)"
      placeholder="Select PO Number"
      [suggestions]="filteredPO"
      (completeMethod)="filterPO($event)"
      field="PODocumentID"
      [dropdown]="true"
    >
      <ng-template let-country pTemplate="item">
        <div class="country-item">
          <div class="f-12">{{ country.PODocumentID }}</div>
        </div>
      </ng-template>
    </p-autoComplete>
  </div>
  <div
    class="col-md-12 p-0 pl-1"
    [ngClass]="showPdf ? 'col-lg-5' : 'col-lg-12'"
  >
    <ul
      class="nav nav-tabs"
      id="myTab"
      role="tablist"
      [ngClass]="showPdf ? 'w-100' : 'w-42'"
    >
      <li
        class="nav-item mr-2"
        pTooltip="Vendor details"
        tooltipPosition="top"
        (click)="changeTab('vendor')"
      >
        <a
          class="nav-link"
          id="vendor-tab"
          data-toggle="tab"
          href="#vendor"
          role="tab"
          aria-controls="vendor"
          aria-selected="true"
        >
          <span *ngIf="ap_boolean">Vendor</span>
          <span *ngIf="!ap_boolean">Customer</span>
        </a>
      </li>
      <li
        class="nav-item mr-2"
        pTooltip="Header details"
        tooltipPosition="top"
        (click)="changeTab('header')"
      >
        <a
          class="nav-link"
          id="header-tab"
          data-toggle="tab"
          href="#header"
          role="tab"
          aria-controls="header"
          aria-selected="false"
          >Header</a
        >
      </li>
      <li
        class="nav-item"
        pTooltip="Line details"
        tooltipPosition="top"
        (click)="changeTab('line')"
      >
        <a
          class="nav-link active" 
          id="line-tab"
          data-toggle="tab"
          href="#line"
          role="tab"
          aria-controls="line"
          aria-selected="false"
          >Line details</a
        >
      </li>

      <li
        class="nav-item ml-2"
        pTooltip="PO Lines details"
        tooltipPosition="top"
        (click)="changeTab('poline')"
        *ngIf="Itype == 'Invoice' && partytype == 'vendor'"
      >
        <a
          class="nav-link"
          id="POline-tab"
          data-toggle="tab"
          href="#POline"
          role="tab"
          aria-controls="POline"
          aria-selected="false"
          >PO Lines</a
        >
      </li>

      <li
        class="nav-item ml-2"
        pTooltip="GRN details"
        tooltipPosition="top"
        *ngIf="!grnCreateBoolean && ap_boolean"
        (click)="changeTab('grn')"
      >
        <a
          class="nav-link"
          id="grn-tab"
          data-toggle="tab"
          href="#grn"
          role="tab"
          aria-controls="grn"
          aria-selected="false"
          >GRN Data</a
        >
      </li>
      <!-- <button class="raiseAlert" pTooltip="raise an alert" tooltipPosition="top"><i class="fa fa-exclamation-triangle"
            aria-hidden="true"></i></button> -->
    </ul>
    <div class="tabsDiv bg-design-all">
      <div *ngIf="!isDesktop" class="vi_mb_btn f-12" (click)="doc_view()">
        <i class="fa fa-eye"></i> View Document
      </div>
      <form #form="ngForm" class="tabDiv" id="myTabContent">
        <div class="tab-content">
          <ng-container *ngTemplateOutlet="vendor"></ng-container>
          <ng-container *ngTemplateOutlet="header"></ng-container>
          <ng-container *ngTemplateOutlet="line"></ng-container>
          <ng-container *ngTemplateOutlet="poline"></ng-container>
          <ng-container *ngTemplateOutlet="grn"></ng-container>
        </div>

        <ng-template #vendor>
          <!-- vendor -->
          <div
            class="tab-pane fade"
            id="vendor"
            role="tabpanel"
            aria-labelledby="vendor-tab"
          >
            <div class="displayFlex">
              <div *ngFor="let data of vendorData | keyvalue; let i = index">
                <div>
                  <label class="label-head" style="margin-bottom: -5px"
                    >{{ data.key }}
                  </label>
                  <input
                    #inputv
                    type="text"
                    [value]="data.value"
                    [title]="data.value"
                    disabled
                    class="form-control mb-1 inputHeight"
                  />
                </div>
              </div>
            </div>
          </div>
        </ng-template>

        <ng-template #header>
          <!-- header -->
          <div
            class="tab-pane fade"
            id="header"
            role="tabpanel"
            aria-labelledby="header-tab"
          >
            <div class="displayFlex">
              <div *ngFor="let value of inputData">
                <div style="position: relative">
                  <label class="label-head" style="margin-bottom: -5px"
                    >{{ value.TagLabel }}
                    <span
                      *ngIf="value.isError >= 1"
                      [pTooltip]="value.ErrorDesc"
                      tooltipPosition="top"
                      ><i
                        class="fa fa-info-circle info_icon"
                        aria-hidden="true"
                      ></i
                    ></span>
                  </label>
                  <input
                    #inputv
                    type="text"
                    [value]="value.Value"
                    [title]="value.Value"
                    [disabled]="!editable || fin_boolean"
                    [ngStyle]="{
                      border:
                        value.isError >= 1
                          ? '2px solid red'
                          : value.isError === 0 && value.IsUpdated === 0
                          ? '1px solid lightgray'
                          : value.IsUpdated === 1
                          ? '2px solid #37dcc7'
                          : ''
                    }"
                    (change)="
                      onChangeValue(value.TagLabel, inputv.value, value)
                    "
                    (blur)="saveChanges()"
                    class="form-control mb-1 inputHeight"
                  />
                  <span
                    *ngIf="
                      value.DocumentUpdates && value.DocumentUpdates.OldValue
                    "
                  >
                    <span class="old_value"
                      >Old Value :
                      <span style="color: #f38a6b"
                        >"{{ value.DocumentUpdates.OldValue }}"</span
                      >
                    </span>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </ng-template>

        <ng-template #line>
          <!-- line -->
          <div
            class="tab-pane fade show active"
            id="line"
            role="tabpanel"
            aria-labelledby="line-tab"
          >
            <div *ngIf="!isDesktop && editable && router.url.includes('comparision-docs')" class="d-flex mb-1" style="gap:5px">
              <button
                *ngIf="ap_boolean"
                class="btnUpload m-t-neg btn_extra_bg ml-2 mr-2"
                [ngClass]="subStatusId == 75 || subStatusId == 17 ? 'bt-hlt' : ''"
                (click)="opengrnDailog()"
              >
                Select GRN
              </button>
              <button
                *ngIf="
                  portalName == 'customer' &&
                  flipEnabled &&
                  (subStatusId == 8 ||
                    subStatusId == 16 ||
                    subStatusId == 21 ||
                    subStatusId == 27)
                "
                class="btnUpload btn_extra_bg m-t-neg ml-2"
                (click)="open_dialog_comp('flip line','')"
              >
                Flip PO
              </button>
            </div>
            <div *ngIf="!showPdf && !ap_boolean && !isDesktop" class="d-flex mb-1" style="gap:5px">
              
              <div>
                <button class="f-12 btn_stck mr-3">
                  View Stock Availability
                </button>
              </div>
              <div>
                <button class="f-12 btn_hold">Put PO On Hold</button>
              </div>
            </div>
            <div *ngIf="!grnCreateBoolean && partytype != 'customer'">
              <div class="d-flex " [ngClass]="isDesktop ? 'justify-content-end':'justify-content-start'">
                <div class="d-flex mr-3">
                  <div class="represent_color invoice_color"></div>
                  <div class="f-12">
                    <span *ngIf="partytype == 'vendor'">Invoice</span>
                    <span *ngIf="partytype == 'customer'">PO</span>
                  </div>
                </div>

                <div class="d-flex mr-3">
                  <div class="represent_color po_color"></div>
                  <div class="f-12">
                    <span *ngIf="partytype == 'vendor'">PO</span>
                    <span *ngIf="partytype == 'customer'">
                      Proposed Sales Order</span
                    >
                  </div>
                </div>

                <!-- <div class="d-flex">
                <div class="represent_color grn_color"></div>
                <div class="f-12">GRN</div>
              </div> -->
              </div>

              <table *ngIf="partytype == 'vendor'" class="w-100 mt-2">
                <tr>
                  <td class="count_line">
                    <span class="f-12 p-2" style="margin-top: -6px">S.No</span>
                    <div
                      class="f-12 mb-3 count-h"
                      *ngFor="let tagName of lineCount; let i = index"
                    >
                      {{ i + 1 }}
                    </div>
                  </td>
                  <td
                    class="f-13"
                    *ngFor="let tagName of lineDisplayData"
                    [ngStyle]="{
                      width:
                        tagName?.tagname == 'Description' ? '500px' : '200px'
                    }"
                  >
                    <span class="f-13 p-2">{{ tagName.tagname }}</span>
                    <div *ngFor="let data of tagName.items">
                      <div *ngFor="let data2 of data.linedetails" class="mb-3">
                        <div
                          [ngClass]="
                            data2?.invline[0]?.DocumentLineItems?.isError >= 1
                              ? 'error-border'
                              : ''
                          "
                        >
                          <div
                            class="f-12 td_padding invoice_color doc_height"
                            [attr.data-text]="lineTxt1"
                            [ngClass]="
                              tagName.tagname == 'Description' ? 'textType' : ''
                            "
                          >
                            <div
                              class="error-block"
                              [ngClass]="
                                data2.invline[0]?.DocumentLineItems.isError >= 1
                                  ? 'error-symbol'
                                  : ''
                              "
                              [pTooltip]="
                                data2.invline[0]?.DocumentLineItems?.ErrorDesc
                              "
                              tooltipPosition="top"
                            ></div>
                            <input
                              type="text"
                              #lineInput
                              [title]="
                                data2.invline[0]?.DocumentLineItems.Value
                              "
                              [value]="
                                data2.invline[0]?.DocumentLineItems.Value
                              "
                              class="f-12 input_disabled"
                              style="text-transform: lowercase"
                              [disabled]="!editable || fin_boolean"
                              (change)="
                                onChangeLineValue(
                                  tagName.tagname,
                                  lineInput.value,
                                  data2.invline[0]?.DocumentLineItems
                                )
                              "
                              (blur)="saveChanges()"
                              [ngClass]="!editable ? 'input_disabled' : ''"
                              [ngStyle]="{
                                width:
                                  tagName.tagname == 'Description'
                                    ? '-webkit-fill-available'
                                    : '60px'
                              }"
                            />
                            <span
                              *ngIf="data2.invline[0]?.DocumentUpdates"
                              class="prev_value"
                              [title]="
                                data2.invline[0]?.DocumentUpdates.OldValue
                              "
                              >prev:
                              {{
                                data2.invline[0]?.DocumentUpdates.OldValue
                              }}</span
                            >
                          </div>
                          <div
                            class="f-12 td_padding po_color doc_height"
                            [attr.data-text]="lineTxt2"
                            [ngClass]="
                              tagName.tagname == 'Description' ? 'textType' : ''
                            "
                          >
                            <div class="error-block"></div>
                            <input
                              type="text"
                              [title]="data2.poline[0]?.Value"
                              [value]="data2.poline[0]?.Value"
                              class="f-12 input_disabled"
                              style="text-transform: lowercase"
                              disabled
                              [ngClass]="!editable ? 'input_disabled' : ''"
                              [ngStyle]="{
                                width:
                                  tagName.tagname == 'Description'
                                    ? '-webkit-fill-available'
                                    : '60px'
                              }"
                            />
                            <!-- <span *ngIf="(approveBtn_boolean)" class="prev_value">prev: 345</span> -->
                            <!-- <div class="f-12">
                        <select class="f-12 input_disabled form-control" placeholder="mapping"
                          [disabled]="!editable || fin_boolean" (change)="displayErrorDialog = true">
                          <option class="f-12" *ngFor="let line of totalLineItems" [value]="line">{{line}}</option>
                        </select>
                      </div> -->
                          </div>

                          <!-- <div
                          class="f-12 td_padding grn_color doc_height"
                          data-text="GR"
                          [ngClass]="
                            tagName.tagname == 'Description' ? 'textType' : ''
                          "
                        >
                          <div class="error-block"></div>
                          <input
                            type="text"
                            [title]="data2.grnline[0]?.Value"
                            [value]="data2.grnline[0]?.Value"
                            class="f-12 input_disabled w-fill"
                            style="text-transform: lowercase"
                            disabled
                            [ngClass]="!editable ? 'input_disabled' : ''"
                          />
                        </div> -->
                        </div>
                      </div>
                    </div>
                  </td>

                  <td
                    [ngStyle]="{ width: mappedData?.length == 0 ? '' : '25%' }"
                  >
                    <!-- <div class="visiblity_hidden">Dummy Data</div> -->
                    <span class="f-13 p-2 mapping_line"
                      >Line items mapping</span
                    >
                    <div style="margin-top: -5px">
                      <div *ngFor="let data of lineCount">
                        <div
                          *ngFor="let data2 of data.linedetails"
                          class="mb-3"
                        >
                          <div class="f-12 td_padding invoice_color doc_height">
                            <input
                              type="text"
                              [title]="data2.invline[0]?.Value"
                              [value]="data2.invline[0]?.Value"
                              class="f-12 input_disabled visiblity_hidden"
                              style="text-transform: lowercase"
                              (blur)="displayErrorDialog = true"
                              [disabled]="!editable || fin_boolean"
                              [ngClass]="!editable ? 'input_disabled' : ''"
                            />
                          </div>
                          <div class="f-12 td_padding po_color doc_height">
                            <!-- <div class="error-block error-symbol"></div> -->

                            <div class="f-12 d-flex" *ngIf="submitBtn_boolean">
                              <select
                                class="f-11 input_disabled form-control sel_drp"
                                name="lineSelection"
                                placeholder="mapping"
                                ngModel
                                (change)="
                                  lineMapping(
                                    data.linedetails[0].invline[0]
                                      ?.DocumentLineItems?.itemCode,
                                    $event.target.value,
                                    data.itemcode
                                  )
                                "
                              >
                                <option class="f-11" selected disabled>
                                  Select Line items
                                </option>
                                <option
                                  class="f-11"
                                  *ngFor="let line of lineItems"
                                  [value]="line.itemCode"
                                >
                                  {{ line.Value }}
                                </option>
                              </select>
                              <div
                                class="d-inline-block display-mapped"
                                *ngFor="let description of mappedData"
                              >
                                <span
                                  class="f-11"
                                  *ngIf="
                                    description?.ItemUserMap
                                      ?.mappedinvoiceitemcode ==
                                    data.linedetails[0].invline[0]
                                      ?.DocumentLineItems?.itemCode
                                  "
                                  [title]="
                                    description?.ItemMetaData?.description
                                  "
                                >
                                  {{ description?.ItemMetaData?.description }}
                                </span>
                              </div>
                            </div>
                          </div>
                          <!-- <div class="f-12 td_padding grn_color doc_height">
                          <input
                            type="text"
                            [title]="data2.invline[0]?.Value"
                            [value]="data2.invline[0]?.Value"
                            class="f-12 input_disabled visiblity_hidden"
                            style="text-transform: lowercase"
                            (blur)="displayErrorDialog = true"
                            [disabled]="!editable || fin_boolean"
                            [ngClass]="!editable ? 'input_disabled' : ''"
                          />
                        </div> -->
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
              </table>

              <table *ngIf="partytype == 'customer'" class="w-100 mt-2">
                <tr>
                  <td class="count_line">
                    <span class="f-12 p-2" style="margin-top: -6px">S.No</span>
                    <div
                      class="f-12 mb-3 count-h"
                      *ngFor="let tagName of lineCount; let i = index"
                    >
                      {{ i + 1 }}
                    </div>
                  </td>
                  <td
                    class="f-13"
                    *ngFor="let tagName of lineDisplayData"
                    [ngStyle]="{
                      width:
                        tagName?.tagname == 'Description' ? '500px' : '200px'
                    }"
                  >
                    <span class="f-13 p-2">{{ tagName.tagname }}</span>
                    <div *ngFor="let data of tagName.items">
                      <div *ngFor="let data2 of data.linedetails" class="mb-3">
                        <div
                          [ngClass]="
                            data2?.polinedata[0]?.DocumentLineItems?.isError >=
                            1
                              ? 'error-border'
                              : ''
                          "
                        >
                          <div
                            class="f-12 td_padding invoice_color doc_height"
                            [attr.data-text]="lineTxt1"
                            [ngClass]="
                              tagName.tagname == 'Description' ? 'textType' : ''
                            "
                          >
                            <div
                              class="error-block"
                              [ngClass]="
                                data2.polinedata[0]?.DocumentLineItems
                                  .isError >= 1
                                  ? 'error-symbol'
                                  : ''
                              "
                              [pTooltip]="
                                data2.polinedata[0]?.DocumentLineItems
                                  ?.ErrorDesc
                              "
                              tooltipPosition="top"
                            ></div>
                            <input
                              type="text"
                              #lineInput
                              [title]="
                                data2.polinedata[0]?.DocumentLineItems.Value
                              "
                              [value]="
                                data2.polinedata[0]?.DocumentLineItems.Value
                              "
                              class="f-12 input_disabled"
                              style="text-transform: lowercase"
                              [disabled]="!editable || fin_boolean"
                              (change)="
                                onChangeLineValue(
                                  tagName.tagname,
                                  lineInput.value,
                                  data2.polinedata[0]?.DocumentLineItems
                                )
                              "
                              (blur)="saveChanges()"
                              [ngClass]="!editable ? 'input_disabled' : ''"
                              [ngStyle]="{
                                width:
                                  tagName.tagname == 'Description'
                                    ? '-webkit-fill-available'
                                    : '60px'
                              }"
                            />
                            <span
                              *ngIf="data2.polinedata[0]?.DocumentUpdates"
                              class="prev_value"
                              [title]="
                                data2.polinedata[0]?.DocumentUpdates.OldValue
                              "
                              >prev:
                              {{
                                data2.polinedata[0]?.DocumentUpdates.OldValue
                              }}</span
                            >
                          </div>
                          <div
                            class="f-12 td_padding po_color doc_height"
                            [attr.data-text]="lineTxt2"
                            [ngClass]="
                              tagName.tagname == 'Description' ? 'textType' : ''
                            "
                          >
                            <div class="error-block"></div>
                            <input
                              type="text"
                              [title]="
                                data2.solinedata[0]?.DocumentLineItems?.Value
                              "
                              [value]="
                                data2.solinedata[0]?.DocumentLineItems?.Value
                              "
                              class="f-12 input_disabled"
                              style="text-transform: lowercase"
                              disabled
                              [ngClass]="!editable ? 'input_disabled' : ''"
                              [ngStyle]="{
                                width:
                                  tagName.tagname == 'Description'
                                    ? '-webkit-fill-available'
                                    : '60px'
                              }"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </td>

                  <td
                    [ngStyle]="{ width: mappedData?.length == 0 ? '' : '25%' }"
                  >
                    <!-- <div class="visiblity_hidden">Dummy Data</div> -->
                    <span class="f-13 p-2 mapping_line"
                      >Line items mapping</span
                    >
                    <div style="margin-top: -5px">
                      <div *ngFor="let data of lineCount">
                        <div
                          *ngFor="let data2 of data.linedetails"
                          class="mb-3"
                        >
                          <div class="f-12 td_padding invoice_color doc_height">
                            <input
                              type="text"
                              [title]="data2.polinedata[0]?.Value"
                              [value]="data2.polinedata[0]?.Value"
                              class="f-12 input_disabled visiblity_hidden"
                              style="text-transform: lowercase"
                              (blur)="displayErrorDialog = true"
                              [disabled]="!editable || fin_boolean"
                              [ngClass]="!editable ? 'input_disabled' : ''"
                            />
                          </div>
                          <div
                            class="f-12 td_padding po_color doc_height"
                          ></div>
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
              </table>
            </div>

            <!-- Create GRN screen Line details -->
            <div *ngIf="grnCreateBoolean && partytype != 'customer'" class="mt-3">
              <table class="invert" style="width: 100%">
                <tr class="invert_tr">
                  <td
                    class="lineName invert_th_td text-center"
                    style="min-width: 50px"
                  >
                    S.No
                  </td>
                  <td
                    class="count_line"
                    *ngFor="let item2 of grnLineCount; let ind = index"
                  >
                    <div class="s-no">
                      {{ ind + 1 }}
                    </div>
                  </td>
                </tr>
                <tr
                  class="invert_tr"
                  *ngFor="let item of lineDisplayData; let i = index"
                >
                  <td
                    class="lineName invert_th_td"
                    *ngIf="
                      !item.TagName.includes('UnitPrice') &&
                      !item.TagName.includes('AmountExcTax')
                    "
                    [ngClass]="item.TagName === 'Actions' ? 'm-l-neg' : ''"
                  >
                    {{ item.TagName }}
                  </td>
                  <td
                    class="linevalue invert_th_td"
                    *ngFor="let line1 of item.linedata"
                  >
                    <div
                      *ngIf="
                        item.TagName != 'GRN - Quantity' &&
                        item.TagName != 'Comments' &&
                        !item.TagName.includes('UnitPrice') &&
                        !item.TagName.includes('AmountExcTax') &&
                        item.TagName !== 'Actions'
                      "
                    >
                      <span class="d-flex">
                        <input
                          type="text"
                          [ngClass]="
                            item.TagName == 'Description' ? 'w-des' : 'w-sm'
                          "
                          [name]="item.TagName"
                          [value]="line1.Value"
                          [title]="line1.Value"
                          [disabled]="item.TagName != 'GRN - Quantity'"
                          class="form-control mb-1 inputHeight"
                        />
                      </span>
                      <!-- <span [ngStyle]="{'visibility':line1.POValue ? 'visible':'hidden'}">
                        <span
                      data-text="PO"
                      class="d-flex"
                      [ngClass]="item.TagName == 'Description' ? 'textType' : ''" 
                      >
                      <input
                          type="text"
                          [ngClass]="
                            item.TagName == 'Description' ? 'w-des' : 'w-sm'
                          "
                          [name]="item.TagName"
                          [value]="line1.POValue"
                          [title]="line1.POValue"
                          [disabled]="(item.TagName != 'GRN - Quantity')"
                          class="form-control mb-1 inputHeight"
                        />
                    </span>
                        
                      </span> -->
                    </div>
                    <div
                      *ngIf="
                        !(item.TagName != 'GRN - Quantity') &&
                        item.TagName != 'Comments' &&
                        !item.TagName.includes('UnitPrice') &&
                        !item.TagName.includes('AmountExcTax') &&
                        item.TagName !== 'Actions'
                      "
                    >
                      <span>
                        <input
                          #inputval
                          type="text"
                          [ngClass]="
                            item.TagName == 'Description' ? 'w-des' : 'w-sm'
                          "
                          style="border: 1px solid #efc384"
                          [name]="line1.idDocumentLineItems"
                          [value]="line1.Value"
                          [title]="line1.Value"
                          class="form-control mb-1 inputHeight"
                          [(ngModel)]="line1.Value"
                        />
                      </span>
                      <!-- <span style="visibility: hidden;">
                        <input
                          type="text"
                          class="form-control mb-1 inputHeight"
                        />
                      </span> -->
                    </div>
                    <div
                      *ngIf="
                        !GRN_PO_Bool &&
                        item.TagName == 'Comments' &&
                        !item.TagName.includes('UnitPrice') &&
                        !item.TagName.includes('AmountExcTax') &&
                        item.TagName !== 'Actions'
                      "
                    >
                      <span>
                        <input
                          #inputval
                          type="text"
                          style="width: 150px"
                          [ngClass]="
                            item.TagName == 'Description' ? 'w-des' : 'w-sm'
                          "
                          [ngModelOptions]="{ standalone: true }"
                          [value]="line1.ErrorDesc"
                          [title]="line1.ErrorDesc"
                          class="form-control mb-1 inputHeight"
                          [(ngModel)]="line1.ErrorDesc"
                        />
                      </span>
                      <!-- <span style="visibility: hidden;">
                        <input
                          type="text"
                          class="form-control mb-1 inputHeight"
                        />
                        (click)="open_dialog('delete', line.value)"
                      </span> -->
                    </div>
                    <div *ngIf="item.TagName === 'Actions' && GRN_PO_Bool">
                      <span class="linevalue invert_thtd">
                        <button
                          style="border-color: transparent"
                          (click)="deleteGrnLine(line1.idDocumentLineItems)"
                        >
                          <i class="fa fa-trash-o" aria-hidden="true"></i>
                        </button>
                      </span>
                    </div>
                  </td>
                </tr>
              </table>
            </div>

            <div
              *ngIf="partytype == 'customer'"
              class="d-flex justify-content-between bg-design-all p-2 mt-3"
            >
              <div class="mr-4">
                <div class="f-14">Purchase Order</div>
                <table class="table f-12">
                  <tr class="tHead">
                    <th>S.No</th>
                    <th *ngFor="let head of lineTable">{{ head.header }}</th>
                  </tr>
                  <tr
                    *ngFor="let poLine of poLinedata; let i = index"
                    class="tbdytr"
                  >
                    <td>{{ i + 1 }}</td>
                    <td>{{ poLine.Description }}</td>
                    <td>{{ poLine.Unit }}</td>
                    <td>
                      <input
                        type="text"
                        class="in-w"
                        [(ngModel)]="poLine.UnitPrice"
                        [value]="poLine.UnitPrice"
                        [name]="poLine.itemCode"
                      />
                    </td>
                    <td>
                      <input
                        type="text"
                        class="in-w"
                        [(ngModel)]="poLine.Quantity"
                        [value]="poLine.Quantity"
                        [name]="poLine.idDocumentLineItems"
                      />
                    </td>
                    <td>{{ poLine.Quantity * poLine.UnitPrice }}</td>
                  </tr>
                </table>
              </div>
              <div>
                <div class="f-14">Proposed Sales Order Lines</div>
                <table class="table f-12">
                  <tr class="tHead">
                    <th>S.No</th>
                    <th *ngFor="let head of lineTable">{{ head.header }}</th>
                    <th *ngIf="editable">Actions</th>
                  </tr>
                  <tr
                    *ngFor="let soLine of soLinedata; let i = index"
                    class="tbdytr"
                  >
                    <td>{{ i + 1 }}</td>
                    <td>
                      <span
                        [ngStyle]="{
                          borderBottom:
                            soLine.Fuzzy_scr >= 80 && soLine.Fuzzy_scr != 100
                              ? '1px solid #162F65'
                              : soLine.Fuzzy_scr <= 60
                              ? '1px solid #FE646F'
                              : ''
                        }"
                        >{{ soLine.Description }}</span
                      >
                    </td>
                    <td>{{ soLine.Unit }}</td>
                    <td>
                      <input
                        type="text"
                        class="in-w"
                        [(ngModel)]="soLine.UnitPrice"
                        [value]="soLine.UnitPrice"
                        [name]="soLine.itemCode"
                      />
                    </td>
                    <!-- <td><input type="text" class="in-w" [(ngModel)]="soLine.Quantity" [value]="soLine.Quantity" [name]="soLine.idDocumentLineItems"> </td> -->

                    <td>{{ soLine.Quantity }}</td>
                    <td>{{ soLine.Quantity * soLine.UnitPrice }}</td>
                    <td *ngIf="editable">
                      <i
                        class="fa fa-pencil-square-o pointer f-13 mr-2"
                        aria-hidden="true"
                        (click)="open_dialog_comp('poMaster',soLine.itemCode)"
                      ></i>
                      <i
                        class="fa fa-trash-o pointer f-13"
                        aria-hidden="true"
                      ></i>
                    </td>
                  </tr>
                </table>
                <!-- <button>Add line</button> -->
              </div>
            </div>
          </div>
        </ng-template>

        <!--PO lines-->
        <ng-template #poline>
          <div
            *ngIf="currentTab == 'poline'"
            class="tab-pane fade"
            id="POline"
            role="tabpanel"
            aria-labelledby="POline-tab"
          >
            <div style="margin-top: 35px;"><po-lines [po_num]="po_num"></po-lines></div>
          </div>
        </ng-template>

        <ng-template #grn>
          <div
            class="tab-pane fade show"
            id="grn"
            role="tabpanel"
            aria-labelledby="grn-tab"
          >
            <mapped-grn></mapped-grn>
          </div>
        </ng-template>

        <div
          *ngIf="editable && !grnCreateBoolean"
          class="btnFooter"
          mat-dialog-actions
        >
          <!-- <button mat-button class="btn btnVender mr-4" type="button">Change attachment</button> -->
          <button
            class="btn btnVender bg-btn-cancel mr-3"
            type="button"
            (click)="backToInvoice()"
          >
            Cancel
          </button>
          <button
            *ngIf="submitBtn_boolean"
            class="btn btnVender bg-btn-cancel mr-3"
            (click)="displayrejectDialog = true"
          >
            Reject
          </button>

          <button
            *ngIf="submitBtn_boolean"
            class="btn btnVender bg-btn-success"
            (click)="beforeBatchTrigger()"
          >
            Send to Batch
          </button>

          <!-- <button *ngIf="financeApproveBoolean && fin_boolean" class="btn btnVender" style="min-width: fit-content;"
          (click)="financeApprove()">Finance
          Approve</button> -->
          <!-- <button *ngIf=" flipBoolean" class="btn btnVender mr-2 " (click)="Create()" >Create</button>
            <button *ngIf="!tabChangeLINEBoolean && flipBoolean"  class="btn btnVender mr-2" (click)="displayAddLabelDialog = true" pTooltip="Add Label" tooltipPosition="top" >Add Label</button>
            <button *ngIf="tabChangeLINEBoolean && flipBoolean" class="btn btnVender " (click)="addLine()" >Add Line</button> -->
        </div>

        <div
          *ngIf="grnCreateBoolean && isGRNDataLoaded && !showPdf"
          class="GRN_btn_position"
        >
          <button
            class="btn btnVender bg-btn-cancel mr-3"
            type="button"
            (click)="backToInvoice()"
          >
            Cancel
          </button>
          <button
            *ngIf="!GRN_PO_Bool"
            class="btn btnVender bg-btn-cancel mr-3"
            type="button"
            (click)="displayrejectDialog = true"
          >
            Reject
          </button>
          <button
            *ngIf="!GRN_PO_Bool"
            class="btn btnVender bg-btn-success mr-3"
            type="submit"
            (click)="
            confirm_pop(form.value, false, 'GRN data saved successfully')
            "
          >
            Save
          </button>
          <button
            class="btn btnVender bg-btn-success mr-3"
            type="submit"
            (click)="
            confirm_pop(form.value, true, 'GRN created successfully')
            "
          >
            Create GRN
          </button>
        </div>
      </form>
      <ngx-spinner
        bdColor="rgba(251, 251, 251, 0.8)"
        size="medium"
        color="#070900"
        [fullScreen]="false"
        type="ball-spin-clockwise"
      >
        <p style="color: rgb(0, 0, 0)"></p>
      </ngx-spinner>
    </div>
  </div>
  <div *ngIf="showPdf" class="col-lg-7 col-12 ShowInvoiceTypeSize doc_mobile"
    [ngStyle]="{ display: documentViewBool ? 'block' : 'none' }">
    <div *ngIf="!isDesktop" class="doc_cls_btn" (click)="doc_view()">
      <i class="fa fa-close"></i>
    </div>
    <app-pdfview [vendorName]="vendorName" [invoiceNumber]="invoiceNumber" [btnText]="btnText" (boolEmit)="getPdfBool($event)" (PdfBtnClick)="viewPdf()"></app-pdfview>
  </div>
</div>

<!-- Rule selection modal-->
<p-dialog
  header="Edit GRN"
  [(visible)]="displayRuleDialog"
  [breakpoints]="{ '960px': '75vw' }"
  [style]="{ width: '50vw' }"
  [baseZIndex]="10000"
  [draggable]="false"
  [resizable]="false"
>
  <div style="min-height: 50vh">
    <div class="d-flex mb-3" style="gap: 20px">
      <!-- select GRN Number -->
      <p-multiSelect
        [options]="po_grn_list"
        placeholder="GRN Number"
        filter="false"
        inputStyleClass="form-control mr-2"
        optionLabel="PackingSlip"
        [maxSelectedLabels]="3"
        [selectedItemsLabel]="'{0} items selected'"
        (onChange)="addGrnLine($event)"
        name="PO_GRN_Number"
        ngModel
        required
      >
      </p-multiSelect>

      <!-- select GRN Line -->
      <p-multiSelect
        [options]="po_grn_line_list"
        placeholder="GRN Line"
        filter="false"
        inputStyleClass="form-control mr-2"
        optionLabel="GRNField"
        [maxSelectedLabels]="3"
        [selectedItemsLabel]="'{0} items selected'"
        name="PO_GRN_Number_line"
        ngModel
        required
        [(ngModel)]="PO_GRN_Number_line"
      >
      </p-multiSelect>

      <!-- <button class="btnUpload" >Add</button>  -->
    </div>
    <div>
      <p-table
        *ngIf="PO_GRN_Number_line?.length > 0"
        [value]="PO_GRN_Number_line"
        [paginator]="false"
        [columns]="summaryColumn"
        styleClass="p-datatable-striped"
      >
        <ng-template pTemplate="header" let-columns>
          <tr>
            <th
              *ngFor="let col of columns"
              [pTooltip]="col.header"
              tooltipPosition="top"
              class="lineName"
              [ngStyle]="{ width: col.header == 'GRN Number' ? '100px' : '' }"
            >
              {{ col.header }}
            </th>
            <th class="action_Zindex" style="width: 60px">Actions</th>
          </tr>
        </ng-template>
        <ng-template
          pTemplate="body"
          let-invoiceData
          let-columns="columns"
          let-rowIndex="rowIndex"
        >
          <tr>
            <td *ngFor="let col of columns" [title]="invoiceData[col.field]">
              {{ invoiceData[col.field] }}
            </td>
            <td>
              <i
                class="fa fa-trash-o"
                style="cursor: pointer"
                (click)="deleteGRNEdit(rowIndex, invoiceData)"
              ></i>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage"> </ng-template>
        <ng-template pTemplate="paginatorleft"> </ng-template>
        <ng-template pTemplate="paginatorright"> </ng-template>
      </p-table>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="d-flex justify-content-center">
      <button
        type="button"
        class="btn btnVender bg-btn-cancel"
        (click)="displayRuleDialog = false"
      >
        Cancel
      </button>
      <button
        type="button"
        class="btn btnVender bg-btn-success"
        [disabled]="!(PO_GRN_Number_line?.length > 0)"
        (click)="ChangeGRNData()"
      >
        Update
      </button>
    </div>
  </ng-template>
</p-dialog>

<!-- Add label-->
<p-dialog
  [header]="headerpop"
  [(visible)]="progressDailogBool"
  [breakpoints]="{ '960px': '75vw' }"
  [style]="{ width: '31vw' }"
  [baseZIndex]="10000"
  [draggable]="false"
  [resizable]="false"
>
  <div *ngIf="headerpop == 'Batch Progress'">
    <div class="f-12" *ngIf="!(batchData?.length > 0)">
      Hey, Please hold on the batch is running...
    </div>
    <ul class="f-12" *ngIf="batchData?.length > 0">
      <li *ngFor="let st of batchData">
        <span [ngStyle]="{ color: st.status == 1 ? 'green' : 'red' }">{{
          st.msg
        }}</span>
      </li>
    </ul>
  </div>
  <div *ngIf="headerpop == 'Select GRN'" class="text-center" style="min-height: 150px">
    <!-- select GRN Number -->
    <p-multiSelect
      [options]="grnList"
      placeholder="GRN Number"
      filter="false"
      inputStyleClass="form-control mr-2"
      optionLabel="docheaderID"
      [maxSelectedLabels]="3"
      [selectedItemsLabel]="'{0} items selected'"
      name="PO_GRN_Number"
      [(ngModel)]="selectedGRNList"
      required
    >
    </p-multiSelect>
  </div>

  <div
    *ngIf="headerpop == 'GRN Creation Status'"
    class="f-13 text-center"
    style="color: #f38a6b"
  >
    {{ APIResponse }}
  </div>
  <ng-template pTemplate="footer">
    <div class="d-flex justify-content-center">
      <button
        *ngIf="headerpop == 'Batch Progress'"
        type="button"
        class="btn btnVender bg-btn-success mt-2"
        (click)="routeToMapping()"
      >
        Next
      </button>
      <button
        *ngIf="headerpop == 'Select GRN'"
        type="button"
        class="btn btnVender bg-btn-cancel mt-2 mr-2"
        (click)="progressDailogBool = false"
      >
        Cancel
      </button>
      <button
        *ngIf="headerpop == 'Select GRN'"
        type="button"
        class="btn btnVender bg-btn-success mt-2"
        [disabled]="!(selectedGRNList?.length > 0)"
        (click)="ChangeGRNDataR()"
      >
        Change
      </button>
      <button
        *ngIf="headerpop == 'GRN Creation Status'"
        type="button"
        class="btn btnVender bg-btn-cancel mt-2 mr-2"
        (click)="backToInvoice()"
      >
        Go Back
      </button>
    </div>
  </ng-template>
</p-dialog>

<!-- edit type selection modal-->
<p-dialog
  header="Select Error type "
  [(visible)]="displayErrorDialog"
  [breakpoints]="{ '960px': '75vw' }"
  [style]="{ width: '31vw' }"
  [baseZIndex]="10000"
  [draggable]="false"
  [resizable]="false"
>
  <div>
    <mat-radio-group
      class="example-radio-group"
      [(ngModel)]="SelectErrorOption"
    >
      <mat-radio-button
        class="example-radio-button f-13"
        *ngFor="let rule of givenErrors"
        [value]="rule.idbatcherrortypes"
      >
        {{ rule.name }}
      </mat-radio-button>
    </mat-radio-group>
  </div>

  <ng-template pTemplate="footer">
    <div class="d-flex justify-content-center">
      <button
        type="button"
        class="btn btnVender bg-btn-cancel"
        (click)="cancelSelectErrorRule()"
      >
        Cancel
      </button>
      <button
        type="button"
        class="btn btnVender bg-btn-success"
        (click)="updateLine()"
      >
        Save Changes
      </button>
    </div>
  </ng-template>
</p-dialog>

<!-- Reject modal-->
<p-dialog
  header="ADD Rejection Comments "
  [(visible)]="displayrejectDialog"
  [breakpoints]="{ '960px': '75vw' }"
  [style]="{ width: '31vw' }"
  [baseZIndex]="10000"
  [draggable]="false"
  [resizable]="false"
>
  <div>


    <label class="label-head mt-2 mb-0">Comments</label>
    <textarea
      name="comments"
      class="form-control"
      style="font-size: 13px"
      minlength="10"
      [(ngModel)]="rejectionComments"
      cols="50"
      rows="2"
      ngModel
      #comments="ngModel"
      required
    ></textarea>
    <small class="noteCss">NOTE: Add atleast 10 characters</small>
  </div>

  <ng-template pTemplate="footer">
    <div class="d-flex justify-content-center">
      <button
        type="button"
        class="btn btnVender bg-btn-cancel"
        (click)="displayrejectDialog = false"
      >
        Cancel
      </button>
      <button
        type="button"
        class="btn btnVender bg-btn-success"
        [disabled]="comments.invalid"
        [ngStyle]="{ cursor: comments.invalid ? 'not-allowed' : 'pointer' }"
        (click)="Reject()"
      >
        Send for Rejection
      </button>
    </div>
  </ng-template>
</p-dialog>
<p-toast></p-toast>
